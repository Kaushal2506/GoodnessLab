<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Goodness Healthcare ‚Äî Dashboard</title>

  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tailwind theme tweaks
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['ui-sans-serif','system-ui','Inter','Segoe UI','Roboto','Helvetica','Arial','sans-serif'] },
          colors: {
            brand: {
              50:'#eefaff',100:'#d8f1ff',200:'#b9e5ff',300:'#8fd6ff',400:'#5ec2ff',
              500:'#2aa7ff',600:'#1b83db',700:'#1767ad',800:'#174f83',900:'#163f66',
            },
          },
          boxShadow: { 'smooth': '0 10px 30px rgba(2, 8, 23, .08)' },
          backgroundImage: {
            'brand-grad': 'linear-gradient(135deg, #2aa7ff 0%, #8D6BFF 50%, #FF7AD9 100%)',
            'card-grad': 'linear-gradient(180deg, rgba(255,255,255,.80), rgba(255,255,255,.65))',
          },
        }
      }
    }
  </script>

  <style>
    /* Frosted look */
    .glass {
      backdrop-filter: saturate(1.2) blur(8px);
      -webkit-backdrop-filter: saturate(1.2) blur(8px);
      background: rgba(255,255,255,0.75);
    }
    .lift:hover { transform: translateY(-2px); }
    .transition-basic { transition: all .2s ease; }

    /* Fill remaining vertical space for iframe */
    .fill-iframe { height: calc(100vh - 180px); } /* adjusts for topbar + title card */
    @media (max-width: 1024px) {
      .fill-iframe { height: calc(100vh - 220px); }
    }

    /* Active nav style helper (applied/removed via JS) */
    .nav-active {
      background-color: white;
      box-shadow: 0 1px 2px rgba(2,8,23,.06), 0 1px 1px rgba(2,8,23,.04);
      outline: 2px solid rgb(143 214 255); /* ~brand-300 */
      outline-offset: 0;
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-sky-50 via-indigo-50 to-rose-50 text-slate-800">

  <!-- Decorative gradient ribbon -->
  <div class="h-1.5 w-full bg-brand-grad"></div>

  <!-- Topbar -->
  <header class="sticky top-0 z-40 bg-white/80 glass shadow-smooth">
    <div class="mx-auto max-w-[1400px] px-4 sm:px-6 lg:px-8">
      <div class="flex items-center gap-3 py-3">
        <!-- Logo (square, rounded corners) -->
        <div class="h-10 w-10 rounded-lg overflow-hidden ring-1 ring-slate-200 flex items-center justify-center">
          <img alt="Goodness Healthcare Logo" class="h-full w-full object-cover"
               src="data:image/svg+xml;utf8,
               <svg xmlns='http://www.w3.org/2000/svg' width='160' height='160'>
                 <defs>
                   <linearGradient id='g' x1='0' x2='1' y1='0' y2='1'>
                     <stop offset='0%' stop-color='%232aa7ff'/>
                     <stop offset='50%' stop-color='%238D6BFF'/>
                     <stop offset='100%' stop-color='%23FF7AD9'/>
                   </linearGradient>
                 </defs>
                 <rect width='160' height='160' rx='18' fill='url(%23g)'/>
                 <g fill='%23ffffff'>
                   <circle cx='55' cy='80' r='26'/>
                   <rect x='88' y='54' width='20' height='52' rx='10'/>
                   <rect x='68' y='70' width='60' height='20' rx='10'/>
                 </g>
               </svg>"/>
        </div>
        <div class="flex-1">
          <h1 class="text-xl sm:text-2xl font-semibold tracking-tight">Goodness Healthcare</h1>
          <p class="text-xs sm:text-sm text-slate-600">Internal Pathology Lab Management</p>
        </div>

        <!-- Mobile sidebar toggle -->
        <button id="sidebarToggle" class="lg:hidden px-3 py-2 rounded-lg bg-white ring-1 ring-slate-200 hover:ring-brand-300 transition-basic"
                aria-label="Toggle menu">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Main layout -->
  <div class="mx-auto max-w-[1400px] px-4 sm:px-6 lg:px-8 py-6">
    <div class="flex gap-6">
      <!-- Sidebar -->
      <aside id="sidebar"
             class="glass w-72 shrink-0 rounded-2xl p-4 ring-1 ring-white/40 shadow-smooth transition-basic
                    fixed top-24 bottom-4 left-4 z-30 translate-x-[-120%] lg:translate-x-0
                    lg:static lg:inset-auto lg:z-auto
                    h-[calc(100vh-7rem)] lg:h-[calc(100vh-8rem)] overflow-y-auto">
        <!-- Signed-in user summary + Sign Out -->
        <div class="mb-4 rounded-xl bg-white/70 p-3 ring-1 ring-slate-200">
          <div class="flex items-center gap-3">
            <div class="h-10 w-10 rounded-full bg-brand-100 ring-1 ring-brand-300 flex items-center justify-center text-brand-700 font-semibold select-none" id="userAvatar">U</div>
            <div class="min-w-0">
              <p id="userName" class="truncate font-semibold text-sm">‚Äî</p>
              <p id="userEmail" class="truncate text-xs text-slate-600">‚Äî</p>
            </div>
          </div>
          <button id="signOutBtn"
                  class="mt-3 w-full rounded-lg bg-gradient-to-r from-brand-500 to-violet-500 py-2 text-white text-sm font-medium shadow-sm hover:shadow
                         active:scale-[.99] transition-basic">
            Sign Out
          </button>
        </div>

        <!-- Nav (text-base + 28px icon boxes) -->
        <nav id="sidebarNav" class="space-y-1 text-base">
          <!-- Each item has data-page to load into iframe -->
          <a href="#" data-page="login-info.html"
             class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic ring-1 ring-transparent hover:ring-brand-200 hover:bg-white"
             data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">üîê</span>
            <span>Login Info</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="home.html"
             class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic ring-1 ring-transparent hover:ring-brand-200 hover:bg-white"
             data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">üè†</span>
            <span>Dashboard</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="entry.html"
             class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic ring-1 ring-transparent hover:ring-brand-200 hover:bg-white"
             data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-brand-100">‚ûï</span>
            <span>Add Entry</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="schedule.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">üóìÔ∏è</span>
            <span>Schedule</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="payment.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">üí≥</span>
            <span>Payment</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="reports.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">üìÑ</span>
            <span>Reports</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="inventory.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">üì¶</span>
            <span>Inventory</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="medical-camp.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">‚õ∫</span>
            <span>Medical Camp</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="database.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">üóÑÔ∏è</span>
            <span>Database</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="test-prices.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">üè∑Ô∏è</span>
            <span>Test Prices</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="staff.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">üë•</span>
            <span>Staff</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="analytics.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">üìä</span>
            <span>Analytics</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="ai-assistant.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">ü§ñ</span>
            <span>AI Assistant</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>

          <a href="#" data-page="about.html" class="nav-item group flex items-center gap-3 rounded-lg px-3 py-2 lift transition-basic hover:bg-white hover:ring-1 hover:ring-brand-200" data-roles="admin,staff">
            <span class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-slate-100 group-hover:bg-brand-100">‚ÑπÔ∏è</span>
            <span>About Us</span>
            <span class="badge hidden ml-auto text-[10px] rounded bg-brand-100 px-1.5 py-0.5 text-brand-700 ring-1 ring-brand-200">current</span>
          </a>
        </nav>
      </aside>

      <!-- Content -->
      <main class="flex-1">
        <!-- Title card -->
        <div class="glass rounded-2xl ring-1 ring-white/40 shadow-smooth p-5 mb-6">
      
      
          </div>
        </div>

        <!-- Full-width, edge-to-edge content box (NO inner padding) -->
        <section class="rounded-2xl ring-1 ring-white/40 shadow-smooth bg-card-grad p-0 overflow-hidden">
          <iframe id="contentFrame"
                  src="entry.html"  <!-- default -->
                  class="block w-full fill-iframe"
                  frameborder="0"
                  marginheight="0"
                  marginwidth="0"
                  title="Section Content">
          </iframe>
        </section>
      </main>
    </div>
  </div>

  <!-- Mobile overlay to close sidebar when open -->
  <div id="overlay" class="fixed inset-0 bg-black/20 backdrop-blur-sm lg:hidden opacity-0 pointer-events-none transition-opacity"></div>

  <!-- Firebase v10 (Modular, CDN) + Auth Guard + Role-based visibility + In-page router -->
  <script type="module">
    // --- Firebase SDKs (v10) ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // --- Config (provided) ---
    const firebaseConfig = {
      apiKey: "AIzaSyCXQyQRw4JRaWDNbca4YQkanMWnfu8SuH0",
      authDomain: "pathologylab-9d156.firebaseapp.com",
      projectId: "pathologylab-9d156",
      storageBucket: "pathologylab-9d156.appspot.com",
      messagingSenderId: "874537581352",
      appId: "1:874537581352:web:9dbcbe269d561c8d676e1d",
      measurementId: "G-S279W29G9Q"
    };

    // --- Init ---
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    let db = null;
    try { db = getFirestore(app); } catch (e) { console.warn("Firestore init skipped/failed:", e); }

    const userNameEl  = document.getElementById('userName');
    const userEmailEl = document.getElementById('userEmail');
    const userAvatar  = document.getElementById('userAvatar');
    const signOutBtn  = document.getElementById('signOutBtn');

    const contentFrame = document.getElementById('contentFrame');
    const contentTitle = document.getElementById('contentTitle');
    const sidebarNav   = document.getElementById('sidebarNav');

    function initialsFromName(name, email) {
      const source = (name || email || 'U').trim();
      const parts = source.split(/\s+/).filter(Boolean);
      if (parts.length >= 2) return (parts[0][0] + parts[1][0]).toUpperCase();
      return source.slice(0,2).toUpperCase();
    }

    function applyRoleVisibility(roleOrRoles) {
      const roleSet = new Set();
      if (Array.isArray(roleOrRoles)) roleOrRoles.forEach(r => roleSet.add(String(r).toLowerCase()));
      else if (roleOrRoles) String(roleOrRoles).split(',').map(s=>s.trim().toLowerCase()).forEach(r => roleSet.add(r));

      document.querySelectorAll('[data-roles]').forEach(el => {
        const allowed = String(el.getAttribute('data-roles') || '')
                          .split(',')
                          .map(s => s.trim().toLowerCase())
                          .filter(Boolean);
        if (allowed.length && roleSet.size) {
          const match = allowed.some(r => roleSet.has(r));
          if (!match) el.classList.add('hidden');
        }
      });
    }

    async function fetchUserRole(uid) {
      if (!db) return null;
      try {
        const snap = await getDoc(doc(db, 'users', uid));
        if (snap.exists()) {
          const data = snap.data();
          return data?.roles ?? data?.role ?? null;
        }
      } catch (err) {
        console.warn('Role fetch failed:', err);
      }
      return null;
    }

    // --- Auth Guard ---
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.replace('login.html'); // redirect when not signed in
        return;
      }
      const name = user.displayName || '';
      const email = user.email || '';
      userNameEl.textContent  = name || '(No display name)';
      userEmailEl.textContent = email || '(No email)';
      userAvatar.textContent  = initialsFromName(name, email);

      const roleOrRoles = await fetchUserRole(user.uid);
      if (roleOrRoles) applyRoleVisibility(roleOrRoles);
    });

    // --- Sign Out ---
    signOutBtn.addEventListener('click', async () => {
      try { await signOut(auth); } catch (e) { alert('Failed to sign out. Please try again.'); console.error(e); }
    });

    // --- Sidebar toggle (mobile) ---
    const sidebar = document.getElementById('sidebar');
    const toggle  = document.getElementById('sidebarToggle');
    const overlay = document.getElementById('overlay');

    function openSidebar() {
      sidebar.style.transform = 'translateX(0)';
      overlay.style.opacity = '1';
      overlay.style.pointerEvents = 'auto';
    }
    function closeSidebar() {
      sidebar.style.transform = '';
      overlay.style.opacity = '0';
      overlay.style.pointerEvents = 'none';
    }
    toggle?.addEventListener('click', () => {
      const isOpen = sidebar.style.transform === 'translateX(0px)' || sidebar.style.transform === 'translateX(0)';
      isOpen ? closeSidebar() : openSidebar();
    });
    overlay?.addEventListener('click', closeSidebar);
    const mq = window.matchMedia('(min-width: 1024px)');
    function handleMQ(e){ if (e.matches) closeSidebar(); }
    mq.addEventListener ? mq.addEventListener('change', handleMQ) : mq.addListener(handleMQ);

    // --- Simple in-page router: load pages into iframe + highlight active ---
    function setActive(linkEl) {
      document.querySelectorAll('.nav-item').forEach(a => {
        a.classList.remove('nav-active');
        a.querySelector('.badge')?.classList.add('hidden');
        a.querySelector('span:nth-child(2)')?.classList.remove('font-semibold','text-brand-800');
      });
      linkEl.classList.add('nav-active');
      linkEl.querySelector('.badge')?.classList.remove('hidden');
      linkEl.querySelector('span:nth-child(2)')?.classList.add('font-semibold','text-brand-800');
    }

    function loadPage(file, linkEl) {
      if (!file) return;
      contentFrame.src = file;
      // Title from link text
      const label = linkEl?.querySelector('span:nth-child(2)')?.textContent?.trim() || 'Section';
      contentTitle.textContent = label;
      if (linkEl) setActive(linkEl);

      // Update hash for deep-linking (optional)
      try { history.replaceState(null, '', `#${encodeURIComponent(file)}`); } catch {}
      closeSidebar(); // auto close on mobile after selecting
    }

    // Click handler for all nav items
    sidebarNav.addEventListener('click', (e) => {
      const a = e.target.closest('.nav-item');
      if (!a) return;
      e.preventDefault();
      const file = a.getAttribute('data-page');
      loadPage(file, a);
    });

    // Support deep-link via URL hash (#entry.html, #reports.html, etc.)
    (function initFromHashOrDefault(){
      const hash = decodeURIComponent(location.hash || '').replace(/^#/, '').trim();
      const startFile = hash || 'entry.html'; // default to Add Entry (entry.html)
      const startLink = [...document.querySelectorAll('.nav-item')].find(a => a.getAttribute('data-page') === startFile)
                        || document.querySelector('.nav-item[data-page="entry.html"]');
      loadPage(startFile, startLink);
    })();
  </script>
</body>
</html>
